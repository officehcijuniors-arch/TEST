<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>U13-Tabelle – HC Innsbruck</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 2rem; color: #222; }
  h1 { margin-bottom: 1rem; }
  #status { margin-bottom: 1rem; font-style: italic; }
  table { border-collapse: collapse; width: 100%; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
  th, td { border: 1px solid #ccc; padding: 8px 10px; text-align: left; }
  th { background: #e0e0e0; }
  tbody tr:nth-child(even) { background: #f9f9f9; }
  .positive { color: green; font-weight: bold; }
  .negative { color: red; font-weight: bold; }
  .punkte { font-weight: bold; }
</style>
</head>
<body>
<h1>U13-Tabelle – HC Innsbruck</h1>
<div id="status">Letzte Aktualisierung: gerade</div>
<table id="tabelle">
  <thead>
    <tr>
      <th>Rang</th>
      <th>Team</th>
      <th>Spiele</th>
      <th>Punkte</th>
      <th>Tordifferenz</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// Flag: true = Daten automatisch von API holen, false = alte Daten behalten
const manualUpdate = false;

// Letzte Kopie der Tabelle (vom Montag)
let jsonData = {
    "data": {
        "rows": [
            {"tableRank":1,"teamLongname":"EC KAC","gamesPlayed":8,"points":24,"goalDifference":"+50"},
            {"tableRank":2,"teamLongname":"\"Rockit-Apfel\" Graz99 Juniors","gamesPlayed":9,"points":24,"goalDifference":"+38"},
            {"tableRank":3,"teamLongname":"EK Zeller Eisbären","gamesPlayed":9,"points":20,"goalDifference":"+27"},
            {"tableRank":4,"teamLongname":"Steel Wings Linz","gamesPlayed":8,"points":17,"goalDifference":"+46"},
            {"tableRank":5,"teamLongname":"EC Red Bull Salzburg","gamesPlayed":9,"points":16,"goalDifference":"+17"},
            {"tableRank":6,"teamLongname":"HC TIWAG Innsbruck - Die Haie","gamesPlayed":10,"points":13,"goalDifference":"+15"},
            {"tableRank":7,"teamLongname":"EC iDM VSV","gamesPlayed":9,"points":12,"goalDifference":"+5"},
            {"tableRank":8,"teamLongname":"EC Lower Austria Stars","gamesPlayed":8,"points":9,"goalDifference":"+16"},
            {"tableRank":9,"teamLongname":"EAC Junior Capitals","gamesPlayed":9,"points":6,"goalDifference":"-10"},
            {"tableRank":10,"teamLongname":"KSV Eishockey - Juniors / Graz99 Juniors","gamesPlayed":8,"points":3,"goalDifference":"-38"},
            {"tableRank":11,"teamLongname":"EV Zeltweg - Murtal Lions","gamesPlayed":9,"points":0,"goalDifference":"-166"}
        ]
    }
};

async function fetchAktuelleDaten() {
    try {
        const url = "https://api.hockeydata.net/data/ebel/Standings?callback=?&apiKey=738aba5a0c15ea7da496e1cda6922ff1&lang=en&referer=www.hcinnsbruck.at&divisionId=oehv-u13-gd";
        const res = await fetch(url);
        const text = await res.text();
        const match = text.match(/\((.*)\)/s);
        if (!match) throw new Error('Keine JSON gefunden');
        jsonData = JSON.parse(match[1]);
        console.log("Daten von API geladen");
    } catch(err) {
        console.error("Fehler beim Laden der API:", err);
    }
}

async function renderTabelle() {
    if (manualUpdate) await fetchAktuelleDaten();
    
    const tbody = document.querySelector("#tabelle tbody");
    tbody.innerHTML = "";
    jsonData.data.rows.forEach(team => {
        const diffClass = team.goalDifference.startsWith('-') ? 'negative' : 'positive';
        tbody.insertAdjacentHTML("beforeend", `
            <tr>
                <td>${team.tableRank}</td>
                <td>${team.teamLongname}</td>
                <td>${team.gamesPlayed}</td>
                <td class="punkte">${team.points}</td>
                <td class="${diffClass}">${team.goalDifference}</td>
            </tr>
        `);
    });
    document.getElementById("status").textContent = "Letzte Aktualisierung: " + new Date().toLocaleTimeString("de-DE");
}

// Initial rendern + optische Aktualisierung jede Minute
renderTabelle();
setInterval(renderTabelle, 60000);
</script>
</body>
</html>
